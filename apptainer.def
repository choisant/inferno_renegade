BootStrap: docker
From: r-base

# Image for running the tests in modelfreeinference

%environment
	export R_LIBS_USER=~/R-packages

%post
	# Install software
	apt-get update -y
	apt-get install curl -y
	apt-get install xml2 -y
	apt-get install libfontconfig1-dev -y
	apt-get install libharfbuzz-dev libfribidi-dev -y
	apt-get install libfreetype6-dev libpng-dev libtiff5-dev libjpeg-dev -y
	apt-get install r-base-dev -y
	apt install build-essential libcurl4-openssl-dev libssl-dev libxml2-dev	 -y
	Rscript -e "install.packages('devtools')"
	Rscript -e "install.packages('iterators')"
	Rscript -e "install.packages('numDeriv')"
	Rscript -e "install.packages('pracma')"
	Rscript -e "install.packages('coda')"
	Rscript -e "install.packages('igraph')"
	Rscript -e "install.packages('rngtools')"
	Rscript -e "install.packages('foreach')"
	Rscript -e "install.packages('nimble')"
	Rscript -e "install.packages('khroma')"
	Rscript -e "install.packages('extraDistr')"
	Rscript -e "install.packages('doRNG')"
	Rscript -e "install.packages('doParallel')"

%runscript
    mkdir ~/R-packages
    echo $R_LIBS_USER
    Rscript -e "devtools::install()"
    Rscript -e "library('modelfreeinference')"
	if [ $? -eq 0 ]; then
        echo "Package modelfreeinference has been installed."
    else
        echo "Package modelfreeinference has not been installed."
    fi
	cd $GITHUB_WORKSPACE && \
	cd development/test_custom && \
	Rscript -e "library('modelfreeinference')" && \
	Rscript test_R_30.R



